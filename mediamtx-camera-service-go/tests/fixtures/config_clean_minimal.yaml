# Clean Minimal Configuration - Only actually used parameters
# Removed leftovers from previous refactorings

server:
  host: "0.0.0.0"
  port: 8002
  websocket_path: "/ws"
  max_connections: 100
  read_timeout: 5s
  write_timeout: 1s
  ping_interval: 30s
  pong_wait: 60s
  max_message_size: 1048576

mediamtx:
  # Core MediaMTX settings (actually used)
  host: "localhost"
  api_port: 9997
  rtsp_port: 8554
  config_path: "/tmp/mediamtx.yml"  # Required by validation but not used in business logic
  recordings_path: "/tmp/recordings"
  snapshots_path: "/tmp/snapshots"
  override_mediamtx_paths: true  # CRITICAL: Override MediaMTX global config with fixture paths
  
  # Stream readiness settings
  stream_readiness:
    controller_ticker_interval: 1  # 1 second for tests
  
  # Health monitoring (actually used)
  health_check_interval: 30
  health_failure_threshold: 3
  health_circuit_breaker_timeout: 60
  health_max_backoff_interval: 300
  health_recovery_confirmation_threshold: 2
  backoff_base_multiplier: 2.0
  process_termination_timeout: 10.0
  process_kill_timeout: 5.0
  
  # Codec settings (actually used) - STANAG 4609 compliant
  codec:
    video_profile: "high422"   # STANAG 4609 compliant with 4:2:2 support
    video_level: "4.0"         # Tactical system standard
    pixel_format: "yuv422p"    # 4:2:2 for tactical systems
    bitrate: "2M"
    preset: "fast"

camera:
  poll_interval: 0.2  # Faster for tests
  detection_timeout: 2.0  # Faster for tests
  device_range: [0, 1]  # Only check devices that actually exist
  enable_capability_detection: true
  auto_start_streams: false
  capability_timeout: 2.0  # Faster for tests
  capability_retry_interval: 0.5  # Faster for tests
  capability_max_retries: 3
  fallback_poll_interval: 5.0  # 5 seconds for test performance (realistic but faster than 90s default)

logging:
  level: "debug"  # DEBUG level to see what's happening in tests
  format: "json"
  file_enabled: false  # Disable file logging for tests
  file_path: "/tmp/camera-service.log"
  max_file_size: 10485760
  backup_count: 5
  console_enabled: true

recording:
  enabled: true
  format: "fmp4"              # STANAG 4609 compliant (was "mp4")
  quality: "medium"
  segment_duration: 300
  max_segment_size: 104857600
  auto_cleanup: true
  cleanup_interval: 3600
  max_age: 604800
  max_size: 1073741824
  default_rotation_size: 104857600
  default_max_duration: 24h
  default_retention_days: 7
  record_format: "fmp4"
  file_name_pattern: "%path_%Y-%m-%d_%H-%M-%S"
  use_device_subdirs: true

snapshots:
  enabled: true
  format: "jpeg"
  quality: 85
  max_width: 1920
  max_height: 1080
  auto_cleanup: true
  cleanup_interval: 3600
  max_age: 604800
  max_count: 1000
  file_name_pattern: "%device_%Y-%m-%d_%H-%M-%S.jpg"
  use_device_subdirs: true

ffmpeg:
  snapshot:
    process_creation_timeout: 10.0
    execution_timeout: 30.0
    internal_timeout: 5
    retry_attempts: 3
    retry_delay: 1.0
  recording:
    process_creation_timeout: 10.0
    execution_timeout: 30.0
    internal_timeout: 5
    retry_attempts: 3
    retry_delay: 1.0

# Performance settings (actually used)
performance:
  snapshot_tiers:
    tier1_usb_direct_timeout: 5.0
    tier2_rtsp_ready_check_timeout: 2.0
    tier3_activation_timeout: 5.0
    tier3_activation_trigger_timeout: 10.0
    total_operation_timeout: 15.0
    immediate_response_threshold: 0.5
    acceptable_response_threshold: 2.0
    slow_response_threshold: 5.0
  
  # Debounce settings for tests (short periods for immediate testing)
  debounce:
    health_monitor_seconds: 1      # 1 second for tests
    storage_monitor_seconds: 1     # 1 second for tests  
    performance_monitor_seconds: 1  # 1 second for tests
  
  # Monitoring thresholds for tests
  monitoring_thresholds:
    memory_usage_percent: 90.0        # Trigger at 90% memory usage
    error_rate_percent: 5.0           # Trigger at 5% error rate  
    average_response_time_ms: 1000.0  # Trigger at 1000ms response time
    active_connections_limit: 900     # Trigger at 900 connections
    goroutines_limit: 1000            # Trigger at 1000 goroutines

# Storage settings (actually used) - matches JSON-RPC authoritative source
storage:
  warn_percent: 70        # Warning at 70% usage (30% available)
  block_percent: 85       # Critical at 85% usage (15% available)
  default_path: "/tmp/recordings"
  fallback_path: "/tmp/recordings"

# Security settings (actually used)
security:
  rate_limit_requests: 100
  rate_limit_window: 1m
  jwt_secret_key: "test-secret-key"
  jwt_expiry_hours: 24


# External stream discovery configuration
external_discovery:
  enabled: true
  scan_interval: 30
  scan_timeout: 30
  max_concurrent_scans: 5
  enable_startup_scan: false
  skydio:
    enabled: false
    network_ranges: ["192.168.42.0/24"]
    eo_port: 5554
    ir_port: 6554
    eo_stream_path: "/subject"
    ir_stream_path: "/infrared"
    enable_both_streams: true
    known_ips: ["192.168.42.10"]
  generic_uav:
    enabled: true
    network_ranges: ["192.168.1.0/24"]
    common_ports: [554, 8554]
    stream_paths: ["/stream", "/live", "/video"]
    known_ips: ["192.168.1.100"]

# Retention policy (actually used)
retention_policy:
  enabled: true
  type: "age"
  max_age_days: 7
  max_size_gb: 1
  auto_cleanup: true
