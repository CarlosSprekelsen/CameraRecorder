@startuml ModulePositioning
title MediaMTX Module - Architecture Positioning

package "Layer 6: API" {
    component "WebSocket Server" as WS
    component "JSON-RPC Methods" as RPC
}

package "Layer 5: Orchestration" {
    component "MediaMTX Controller" as Controller
    note right of Controller
        Single Source of Truth
        Business Logic Coordination
        API Abstraction Layer
    end note
}

package "Layer 4: Business Logic" {
    component "Recording Manager" as RM
    component "Snapshot Manager" as SM
    component "System Metrics Manager" as SMM
}

package "Layer 3: Infrastructure Managers" {
    component "Path Manager" as PM
    component "Stream Manager" as STM
    component "FFmpeg Manager" as FM
    component "External Discovery" as ED
}

package "Layer 2: Core Services" {
    component "MediaMTX Client" as Client
    component "Health Monitor" as HM
    component "Health Notification Manager" as HNM
    component "RTSP Keepalive Reader" as RKR
    component "RTSP Connection Manager" as RCM
}

WS --> Controller : Pure delegation (3-line methods)
RPC --> Controller : No business logic in API
Controller --> RM : API-ready responses
Controller --> SM : API-ready responses
Controller --> SMM : API-ready responses
Controller --> PM : Device abstraction
Controller --> STM : cameraID-first
Controller --> ED : External streams
Controller --> HM : Health status

RM --> RKR : RTSP activation
SM --> FM : Multi-tier capture
SMM --> RM : Metrics aggregation
PM --> Client : MediaMTX API
HM --> Client : Health checks
HNM --> HM : Notifications

@enduml
